
# پشتیبان‌گیری در Ansible

در Ansible، برای انجام عملیات پشتیبان‌گیری از فایل‌ها، دایرکتوری‌ها و دیتابیس‌ها می‌توان از ماژول‌های مختلفی مانند `copy`، `fetch`، `archive` و دستورات سیستم‌عامل استفاده کرد. در اینجا نحوه انجام این عملیات‌ها توضیح داده می‌شود.

## 1. پشتیبان‌گیری از فایل‌ها با استفاده از ماژول `copy`

ماژول **`copy`** می‌تواند برای کپی کردن فایل‌ها از یک مکان به مکان دیگر (یا همان پشتیبان‌گیری) استفاده شود.

### مثال: پشتیبان‌گیری از یک فایل
```yaml
- name: Backup a configuration file
  copy:
    src: /etc/myconfig.conf
    dest: /tmp/backup/myconfig.conf
    backup: yes
```

در اینجا:
- `src`: مسیر فایل اصلی که قرار است پشتیبان‌گیری شود.
- `dest`: مسیر مقصد که فایل پشتیبان در آنجا ذخیره می‌شود.
- `backup: yes`: این گزینه باعث می‌شود که اگر فایل در مقصد وجود داشته باشد، نسخه‌ای از آن قبل از کپی شدن به عنوان پشتیبان ذخیره شود.

## 2. پشتیبان‌گیری از دایرکتوری‌ها با استفاده از ماژول `archive`

برای پشتیبان‌گیری از دایرکتوری‌ها یا چندین فایل به صورت آرشیو (مانند `tar`)، می‌توانید از ماژول **`archive`** استفاده کنید.

### مثال: پشتیبان‌گیری از یک دایرکتوری
```yaml
- name: Backup a directory to a tar.gz file
  archive:
    path: /etc/myconfig
    dest: /tmp/myconfig_backup.tar.gz
    format: gz
```

در اینجا:
- `path`: مسیر دایرکتوری یا فایل‌هایی است که می‌خواهید پشتیبان‌گیری کنید.
- `dest`: مسیر فایل آرشیو که قرار است پشتیبان در آن ذخیره شود.
- `format: gz`: فرمت آرشیو (مانند `gz` یا `bz2`).

## 3. پشتیبان‌گیری از فایل‌ها با استفاده از ماژول `fetch`

ماژول **`fetch`** برای کپی کردن فایل‌ها از سیستم‌های ریموت به سیستم محلی استفاده می‌شود. این می‌تواند برای گرفتن پشتیبان از سرورهای ریموت مفید باشد.

### مثال: پشتیبان‌گیری از یک فایل از سرور ریموت
```yaml
- name: Fetch a file from the remote host to the local machine
  fetch:
    src: /etc/myconfig.conf
    dest: /tmp/backups/
    flat: yes
```

در اینجا:
- `src`: مسیر فایل روی سرور ریموت.
- `dest`: مسیر مقصد در ماشین محلی که پشتیبان در آن ذخیره می‌شود.
- `flat: yes`: این گزینه باعث می‌شود که ساختار دایرکتوری حفظ نشود و فایل‌ها به صورت مسطح ذخیره شوند.

## 4. پشتیبان‌گیری از دیتابیس‌ها (با استفاده از دستورات سیستم)

اگر بخواهید از یک دیتابیس مانند MySQL یا PostgreSQL پشتیبان بگیرید، می‌توانید از ماژول‌های **`command`** یا **`shell`** استفاده کنید تا دستورات پشتیبان‌گیری را اجرا کنید.

### مثال: پشتیبان‌گیری از MySQL با استفاده از دستورات سیستم
```yaml
- name: Backup MySQL database
  command: mysqldump -u root -p{{ mysql_password }} mydatabase > /tmp/mydatabase_backup.sql
```

در اینجا:
- `mysqldump`: دستور پشتیبان‌گیری از دیتابیس MySQL.
- `-u root -p{{ mysql_password }}`: استفاده از نام کاربری و پسورد MySQL.
- `mydatabase`: نام دیتابیس که از آن پشتیبان گرفته می‌شود.
- `/tmp/mydatabase_backup.sql`: محل ذخیره فایل پشتیبان.

## 5. پشتیبان‌گیری از فایل‌ها با استفاده از ماژول `backup`

ماژول **`backup`** مستقیماً برای پشتیبان‌گیری طراحی نشده، اما به عنوان بخشی از برخی ماژول‌ها، مانند `copy`، برای حفظ نسخه‌های قبلی فایل‌ها استفاده می‌شود.

### مثال ترکیبی از عملیات پشتیبان‌گیری و سپس تغییر فایل
در این مثال، ابتدا از یک فایل پشتیبان تهیه می‌کنیم، سپس محتوای آن را تغییر می‌دهیم:
```yaml
- name: Backup and change a file
  hosts: all
  tasks:
    - name: Backup a configuration file
      copy:
        src: /etc/myconfig.conf
        dest: /tmp/myconfig.conf
        backup: yes

    - name: Modify the configuration file
      lineinfile:
        path: /etc/myconfig.conf
        line: 'newsetting=true'
```

## نتیجه‌گیری:
در Ansible، برای پشتیبان‌گیری از فایل‌ها و دایرکتوری‌ها، می‌توان از ماژول‌های مختلفی استفاده کرد. با استفاده از **`copy`**، **`fetch`**، و **`archive`** می‌توان به راحتی از داده‌ها پشتیبان گرفت و از دستورات سیستم‌عامل برای پشتیبان‌گیری از دیتابیس‌ها یا سایر منابع استفاده کرد.
